<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="shortcut icon" href="//static.xinshangshangxin.com/favicon.ico">
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <title>curl to doc</title>
  <style>
    pre {
      padding: 0;
      background-color: inherit;
      border: none;
    }
  </style>
</head>
<body class="container">
<div class="row">
  <div class="col-xs-12">
    <textarea id="curlStr" class="form-control" rows="10">
      curl --request POST \
  --url http://devops.demo.wifi.cloudnapps.com/api/v1/job \
  --header 'authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiI1OTgxN2Y3ZjdmMjUxYjgyNDFlODQ3NjQiLCJleHBpcmVzQXQiOjE1MTM4NDkxMzA1MDV9.llXvk3iwL2-xB6u6EEa8jp6ZuFu34OCu23QWUL7JTn8' \
  --header 'content-type: application/json' \
  --data '{
	"type": "Cube:cn.magicsdk.cube.jobs.StoreDateCustomer",
	"data": {
		"properties": {
			"cn.magicsdk.cube.from_date": "2017-04-01",
			"cn.magicsdk.cube.to_date": "2017-12-21"
		}
	}
}'
    </textarea>
  </div>
</div>
<div class="row">
  <div class="col-xs-12">
    <button class="btn btn-success copy-btn" data-clipboard-target="#doc">复制</button>

    <form class="form-inline" style="display: inline-block; margin-left: 10px;">
      <div class="form-group">
        <label>JSON space:</label>
        <input id="space" type="number" class="form-control" value="0" style="width: 50px">
      </div>
    </form>

    <div class="checkbox" style="display: inline-block; margin-left: 10px;">
      <label>
        <input id="showCurl" type="checkbox"> curl
      </label>
    </div>

    <div class="checkbox" style="display: inline-block; margin-left: 10px;">
      <label>
        <input id="showHeader" type="checkbox"> header
      </label>
    </div>

    <div class="checkbox" style="display: inline-block; margin-left: 10px;">
      <label>
        <input id="showHeaderAuthorization" type="checkbox"> header authorization
      </label>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-xs-12" id="html"></div>
</div>
<div class="row">
  <div class="col-xs-12">
    <textarea id="doc" class="form-control" rows="10"></textarea>
  </div>
</div>

<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.7.1/clipboard.min.js"></script>
<!-- inject:js -->
<script src="lib/bundle.js"></script>
<!-- endinject -->
<script>

  function loadOptions() {
    let options = getConfig();
    $('#space').val(options.space);
    $('#showCurl').prop('checked', options.curl);
    $('#showHeader').prop('checked', options.header);
    $('#showHeaderAuthorization').prop('checked', options.headerAuthorization);
  }

  function loadBtnCopy(selector) {
    var clipboard = new Clipboard(selector);

    clipboard.on('success', function (e) {
      console.info('Action:', e.action);
      console.info('Text:', e.text);
      console.info('Trigger:', e.trigger);

      e.clearSelection();
    });

    clipboard.on('error', function (e) {
      console.error('Action:', e.action);
      console.error('Trigger:', e.trigger);
    });
  }

  function getConfig() {
    let str = localStorage.getItem('options');
    try {
      return JSON.parse(str) || {};
    }
    catch (e) {
      return {};
    }
  }

  function saveConfig(options) {
    localStorage.setItem('options', JSON.stringify(options));
  }

  function watchInputField(selector, fun) {
    $(selector).bind('input propertychange', fun);
  }

  function showDoc() {
    let str = $('#curlStr').val();
    let space = parseInt($('#space').val()) || 0;
    let showCurl = !!$('#showCurl').prop('checked');
    let header = !!$('#showHeader').prop('checked');
    let headerAuthorization = !!$('#showHeaderAuthorization').prop('checked');
    let options = { space, curl: showCurl, header, headerAuthorization };
    console.info('options: ', options);
    saveConfig(options);

    let doc = curl2doc(str, options);

    $('#doc').val(doc);
    showHtml();
  }

  function showHtml() {
    $('#html').html(
      makeHtml($('#doc').val())
    );
  }

  watchInputField('#curlStr', showDoc);
  watchInputField('#space', showDoc);
  watchInputField('#showCurl', showDoc);
  watchInputField('#doc', showHtml);

  $('input[type=checkbox]').bind('change', function () {
    showDoc();
  });

  loadBtnCopy('.copy-btn');

  loadOptions();
  showDoc();
</script>
</body>
</html>